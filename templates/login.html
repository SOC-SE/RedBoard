{{ template "head.html" . }}

<div class="login-container">
    <div class="login-card" x-data="loginForm()">
        <div class="login-header">
            <div class="login-logo">âš¡</div>
            <h1>NMAP Dashboard</h1>
            <p>Sign in to access the dashboard</p>
        </div>

        <div x-show="error" x-cloak class="alert alert-error mb-4">
            <span x-text="error"></span>
        </div>

        <form @submit.prevent="submit">
            <div class="form-group">
                <label class="form-label" for="username">Username</label>
                <input 
                    type="text" 
                    id="username" 
                    name="user" 
                    class="form-input" 
                    placeholder="Enter your username"
                    x-model="username"
                    required
                    autofocus
                >
            </div>

            <div class="form-group">
                <label class="form-label" for="password">Password</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    class="form-input" 
                    placeholder="Enter your password"
                    x-model="password"
                    required
                >
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 0.5rem;" :disabled="loading">
                <span x-show="!loading">Sign In</span>
                <span x-show="loading" class="loading-spinner"></span>
            </button>
        </form>

        <p class="text-center text-muted text-sm mt-4">
            Don't have an account? <a href="/register.html" style="color: var(--accent-cyan);">Register</a>
        </p>
    </div>
</div>

<script>
function loginForm() {
    return {
        username: '',
        password: '',
        error: '',
        loading: false,

        async submit() {
            this.error = '';
            this.loading = true;

            try {
                const response = await API.post('{{ getAPIBaseURL }}/auth/login', {
                    user: this.username,
                    password: this.password
                });

                if (response.status === 'success') {
                    window.location.href = '{{ getAPIBaseURL }}/main.html';
                } else {
                    this.error = response.message || 'Login failed';
                }
            } catch (err) {
                this.error = err.message || 'Login failed. Please try again.';
            } finally {
                this.loading = false;
            }
        }
    };
}
</script>

{{ template "footer.html" . }}
