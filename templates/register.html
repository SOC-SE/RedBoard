{{ template "head.html" . }}

<div class="login-container">
    <div class="login-card" x-data="registerForm()">
        <div class="login-header">
            <h1>Create Account</h1>
            <p>Register for access</p>
        </div>

        <div x-show="success" x-cloak class="alert alert-success">
            Registration successful! Awaiting admin activation.
        </div>

        <div x-show="error" x-cloak class="alert alert-error" x-text="error"></div>

        <form @submit.prevent="submit" x-show="!success">
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" class="form-input" placeholder="Username" x-model="username" minlength="3" required autofocus>
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" placeholder="Password (min 8 chars)" x-model="password" minlength="8" required>
            </div>
            <div class="form-group">
                <label class="form-label">Confirm Password</label>
                <input type="password" class="form-input" placeholder="Confirm password" x-model="confirm" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;" :disabled="loading">
                <span x-show="!loading">Register</span>
                <span x-show="loading" class="loading-spinner"></span>
            </button>
        </form>

        <p class="text-center text-muted text-sm mt-3">
            Have an account? <a href="/login.html">Sign In</a>
        </p>
    </div>
</div>

<script>
function registerForm() {
    return {
        username: '',
        password: '',
        confirm: '',
        error: '',
        success: false,
        loading: false,

        async submit() {
            this.error = '';
            if (this.password !== this.confirm) {
                this.error = 'Passwords do not match';
                return;
            }
            this.loading = true;
            try {
                const response = await API.post('{{ getAPIBaseURL }}/auth/register', {
                    name: this.username,
                    password: this.password
                });
                if (response.status === 'success') {
                    this.success = true;
                } else {
                    this.error = response.message || 'Registration failed';
                }
            } catch (err) {
                this.error = err.message || 'Registration failed';
            } finally {
                this.loading = false;
            }
        }
    };
}
</script>

{{ template "footer.html" . }}
